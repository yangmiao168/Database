<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>BadgerDB: badgerdb::BTreeIndex Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BadgerDB
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacebadgerdb.html">badgerdb</a></li><li class="navelem"><a class="el" href="classbadgerdb_1_1_b_tree_index.html">BTreeIndex</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classbadgerdb_1_1_b_tree_index-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">badgerdb::BTreeIndex Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classbadgerdb_1_1_b_tree_index.html" title="BTreeIndex class. It implements a B+ Tree index on a single attribute of a relation. This index supports only one scan at a time. ">BTreeIndex</a> class. It implements a B+ Tree index on a single attribute of a relation. This index supports only one scan at a time.  
 <a href="classbadgerdb_1_1_b_tree_index.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="btree_8h_source.html">btree.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a4867de84c5392d9df9cb54438dd35d38"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_b_tree_index.html#a4867de84c5392d9df9cb54438dd35d38">BTreeIndex</a> (const std::string &amp;relationName, std::string &amp;outIndexName, <a class="el" href="classbadgerdb_1_1_buf_mgr.html">BufMgr</a> *bufMgrIn, const int attrByteOffset, const <a class="el" href="namespacebadgerdb.html#a9dc9c8fe64ff894720886ba4b9f81f4b">Datatype</a> attrType)</td></tr>
<tr class="separator:a4867de84c5392d9df9cb54438dd35d38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6a15bba5c82d90e316dd6a1a10cc52a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_b_tree_index.html#ad6a15bba5c82d90e316dd6a1a10cc52a">~BTreeIndex</a> ()</td></tr>
<tr class="separator:ad6a15bba5c82d90e316dd6a1a10cc52a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37ae558488f4080dfdfaf24098192cd3"><td class="memItemLeft" align="right" valign="top">const void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_b_tree_index.html#a37ae558488f4080dfdfaf24098192cd3">insertEntry</a> (const void *key, const <a class="el" href="structbadgerdb_1_1_record_id.html">RecordId</a> rid)</td></tr>
<tr class="separator:a37ae558488f4080dfdfaf24098192cd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0426d99197f0ad5b2054df595243437"><td class="memItemLeft" align="right" valign="top">const void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_b_tree_index.html#aa0426d99197f0ad5b2054df595243437">startScan</a> (const void *lowVal, const <a class="el" href="namespacebadgerdb.html#aad50f9c7a9ef0cbcfe0b025a7aa5cb28">Operator</a> lowOp, const void *highVal, const <a class="el" href="namespacebadgerdb.html#aad50f9c7a9ef0cbcfe0b025a7aa5cb28">Operator</a> highOp)</td></tr>
<tr class="separator:aa0426d99197f0ad5b2054df595243437"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0834ba4655cac7af31ce1b8f2f18f0e1"><td class="memItemLeft" align="right" valign="top">const void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_b_tree_index.html#a0834ba4655cac7af31ce1b8f2f18f0e1">scanNext</a> (<a class="el" href="structbadgerdb_1_1_record_id.html">RecordId</a> &amp;outRid)</td></tr>
<tr class="separator:a0834ba4655cac7af31ce1b8f2f18f0e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78093b184e3ed6faf6edd8e90010583b"><td class="memItemLeft" align="right" valign="top">const void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classbadgerdb_1_1_b_tree_index.html#a78093b184e3ed6faf6edd8e90010583b">endScan</a> ()</td></tr>
<tr class="separator:a78093b184e3ed6faf6edd8e90010583b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classbadgerdb_1_1_b_tree_index.html" title="BTreeIndex class. It implements a B+ Tree index on a single attribute of a relation. This index supports only one scan at a time. ">BTreeIndex</a> class. It implements a B+ Tree index on a single attribute of a relation. This index supports only one scan at a time. </p>

<p>Definition at line <a class="el" href="btree_8h_source.html#l00208">208</a> of file <a class="el" href="btree_8h_source.html">btree.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4867de84c5392d9df9cb54438dd35d38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">badgerdb::BTreeIndex::BTreeIndex </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>relationName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::string &amp;&#160;</td>
          <td class="paramname"><em>outIndexName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classbadgerdb_1_1_buf_mgr.html">BufMgr</a> *&#160;</td>
          <td class="paramname"><em>bufMgrIn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>attrByteOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacebadgerdb.html#a9dc9c8fe64ff894720886ba4b9f81f4b">Datatype</a>&#160;</td>
          <td class="paramname"><em>attrType</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="classbadgerdb_1_1_b_tree_index.html" title="BTreeIndex class. It implements a B+ Tree index on a single attribute of a relation. This index supports only one scan at a time. ">BTreeIndex</a> Constructor. Check to see if the corresponding index file exists. If so, open the file. If not, create it and insert entries for every tuple in the base relation using <a class="el" href="classbadgerdb_1_1_file_scan.html" title="This class is used to sequentially scan records in a relation. ">FileScan</a> class.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">relationName</td><td>Name of file. </td></tr>
    <tr><td class="paramname">outIndexName</td><td>Return the name of index file. </td></tr>
    <tr><td class="paramname">bufMgrIn</td><td>Buffer Manager Instance </td></tr>
    <tr><td class="paramname">attrByteOffset</td><td>Offset of attribute, over which index is to be built, in the record </td></tr>
    <tr><td class="paramname">attrType</td><td>Datatype of attribute over which index is built </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="classbadgerdb_1_1_bad_index_info_exception.html" title="An exception that is thrown when a file operation is requested for a filename that doesn&#39;t exist...">BadIndexInfoException</a></td><td>If the index file already exists for the corresponding attribute, but values in metapage(relationName, attribute byte offset, attribute type etc.) do not match with values received through constructor parameters. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="btree_8cpp_source.html#l00029">29</a> of file <a class="el" href="btree_8cpp_source.html">btree.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="comment">// constructing an index name</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  std :: ostringstream idxStr;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  idxStr &lt;&lt; relationName &lt;&lt; <span class="charliteral">&#39;.&#39;</span> &lt;&lt; attrByteOffset;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  std :: string indexName = idxStr.str();</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// Initialize</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  outIndexName = indexName;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  this-&gt; bufMgr = bufMgrIn;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  this-&gt;attrByteOffset = attrByteOffset;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  leafOccupancy = <a class="code" href="namespacebadgerdb.html#a2195ac9af2c5aa506d1b6ca42ac503f9">INTARRAYLEAFSIZE</a>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  nodeOccupancy = <a class="code" href="namespacebadgerdb.html#a66dbd0723b61fad437f949419e08e200">INTARRAYNONLEAFSIZE</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  Page * metaPage;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  headerPageNum  = 1;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// check if the index file exists</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classbadgerdb_1_1_file.html#a864d59b12302c26b14967bd1d3e520bd">File::exists</a>(outIndexName)){</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// create new blob file</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    file = <span class="keyword">new</span> BlobFile(outIndexName, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// read the meta page</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">readPage</a>(file, headerPageNum, metaPage);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// cast the meta page to meta node</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    IndexMetaInfo* metaNode = (IndexMetaInfo*) metaPage;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// get the root pageNo</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    rootPageNum = metaNode-&gt;rootPageNo;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// unPin the head page</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">unPinPage</a>(file, headerPageNum, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// if the index file not exist, create a new index file</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    file = <span class="keyword">new</span> BlobFile(outIndexName, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    Page * rootPage;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// allocate new meta page</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#ab9ae3b12aac55b119b5763e3de2a4d2b">allocPage</a>(file, headerPageNum, metaPage);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    IndexMetaInfo* metaNode = (IndexMetaInfo*)metaPage;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// allocate new root page</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#ab9ae3b12aac55b119b5763e3de2a4d2b">allocPage</a>(file, rootPageNum, rootPage);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// initialize IndexmetaInfo with the rootPageNum and attrByteOffset</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    metaNode-&gt;attrByteOffset = this-&gt; attrByteOffset;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    metaNode-&gt;rootPageNo = this-&gt; rootPageNum;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// copy the relation name</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    strcpy(metaNode-&gt;relationName, relationName.c_str());</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">// get the root and initialize</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    LeafNodeInt *root = (LeafNodeInt *)rootPage;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    root -&gt; level =0;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    root-&gt; numKeys =0;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// unPin pages that have been pinned</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">unPinPage</a>(file, headerPageNum, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">unPinPage</a>(file,  rootPageNum, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// scan records and insert into the B+ Tree</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    FileScan fscan(relationName, bufMgr);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    RecordId scanRid;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">while</span>(<span class="keyword">true</span>){</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        fscan.scanNext(scanRid);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        std::string recordStr = fscan.getRecord();</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *record = recordStr.c_str();</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <a class="code" href="classbadgerdb_1_1_b_tree_index.html#a37ae558488f4080dfdfaf24098192cd3">insertEntry</a>((<span class="keywordtype">void</span>*)(record+attrByteOffset), scanRid);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordflow">catch</span>(EndOfFileException &amp; e){</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="comment">// do nothing</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_a9f853f0f1d4628e7e14374d0c7c6a4f3"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">badgerdb::BufMgr::readPage</a></div><div class="ttdeci">void readPage(File *file, const PageId PageNo, Page *&amp;page)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00120">buffer.cpp:120</a></div></div>
<div class="ttc" id="namespacebadgerdb_html_a66dbd0723b61fad437f949419e08e200"><div class="ttname"><a href="namespacebadgerdb.html#a66dbd0723b61fad437f949419e08e200">badgerdb::INTARRAYNONLEAFSIZE</a></div><div class="ttdeci">const int INTARRAYNONLEAFSIZE</div><div class="ttdoc">Number of key slots in B+Tree non-leaf for INTEGER key. </div><div class="ttdef"><b>Definition:</b> <a href="btree_8h_source.html#l00055">btree.h:55</a></div></div>
<div class="ttc" id="namespacebadgerdb_html_a2195ac9af2c5aa506d1b6ca42ac503f9"><div class="ttname"><a href="namespacebadgerdb.html#a2195ac9af2c5aa506d1b6ca42ac503f9">badgerdb::INTARRAYLEAFSIZE</a></div><div class="ttdeci">const int INTARRAYLEAFSIZE</div><div class="ttdoc">Number of key slots in B+Tree leaf for INTEGER key. </div><div class="ttdef"><b>Definition:</b> <a href="btree_8h_source.html#l00049">btree.h:49</a></div></div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_aa9bdf04c8543f59744db22efa9420c89"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">badgerdb::BufMgr::unPinPage</a></div><div class="ttdeci">void unPinPage(File *file, const PageId PageNo, const bool dirty)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00154">buffer.cpp:154</a></div></div>
<div class="ttc" id="classbadgerdb_1_1_b_tree_index_html_a37ae558488f4080dfdfaf24098192cd3"><div class="ttname"><a href="classbadgerdb_1_1_b_tree_index.html#a37ae558488f4080dfdfaf24098192cd3">badgerdb::BTreeIndex::insertEntry</a></div><div class="ttdeci">const void insertEntry(const void *key, const RecordId rid)</div><div class="ttdef"><b>Definition:</b> <a href="btree_8cpp_source.html#l00133">btree.cpp:133</a></div></div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_ab9ae3b12aac55b119b5763e3de2a4d2b"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#ab9ae3b12aac55b119b5763e3de2a4d2b">badgerdb::BufMgr::allocPage</a></div><div class="ttdeci">void allocPage(File *file, PageId &amp;PageNo, Page *&amp;page)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00213">buffer.cpp:213</a></div></div>
<div class="ttc" id="classbadgerdb_1_1_file_html_a864d59b12302c26b14967bd1d3e520bd"><div class="ttname"><a href="classbadgerdb_1_1_file.html#a864d59b12302c26b14967bd1d3e520bd">badgerdb::File::exists</a></div><div class="ttdeci">static bool exists(const std::string &amp;filename)</div><div class="ttdef"><b>Definition:</b> <a href="file_8cpp_source.html#l00046">file.cpp:46</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad6a15bba5c82d90e316dd6a1a10cc52a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">badgerdb::BTreeIndex::~BTreeIndex </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="classbadgerdb_1_1_b_tree_index.html" title="BTreeIndex class. It implements a B+ Tree index on a single attribute of a relation. This index supports only one scan at a time. ">BTreeIndex</a> Destructor. End any initialized scan, flush index file, after unpinning any pinned pages, from the buffer manager and delete file instance thereby closing the index file. Destructor should not throw any exceptions. All exceptions should be caught in here itself. </p>

<p>Definition at line <a class="el" href="btree_8cpp_source.html#l00121">121</a> of file <a class="el" href="btree_8cpp_source.html">btree.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="comment">// flushing the index file, </span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#acc61d1985720411ebb76e70f702827d3">flushFile</a>(file);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="comment">// delete file instance thereby close the index file</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keyword">delete</span> file;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_acc61d1985720411ebb76e70f702827d3"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#acc61d1985720411ebb76e70f702827d3">badgerdb::BufMgr::flushFile</a></div><div class="ttdeci">void flushFile(const File *file)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00171">buffer.cpp:171</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a78093b184e3ed6faf6edd8e90010583b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void badgerdb::BTreeIndex::endScan </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Terminate the current scan. Unpin any pinned pages. Reset scan specific variables. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="classbadgerdb_1_1_scan_not_initialized_exception.html" title="An exception that is thrown when a file operation is requested for a filename that doesn&#39;t exist...">ScanNotInitializedException</a></td><td>If no scan has been initialized. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="btree_8cpp_source.html#l00599">599</a> of file <a class="el" href="btree_8cpp_source.html">btree.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                               {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="comment">// If no scan has been initialized throws ScanNotInitializedException</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="keywordflow">if</span>(!scanExecuting) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">throw</span> ScanNotInitializedException();</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">// unPin any pinned pages</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordflow">if</span>(currentPageNum != 0){</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">unPinPage</a>(file, currentPageNum,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  scanExecuting = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;}</div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_aa9bdf04c8543f59744db22efa9420c89"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">badgerdb::BufMgr::unPinPage</a></div><div class="ttdeci">void unPinPage(File *file, const PageId PageNo, const bool dirty)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00154">buffer.cpp:154</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a37ae558488f4080dfdfaf24098192cd3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void badgerdb::BTreeIndex::insertEntry </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structbadgerdb_1_1_record_id.html">RecordId</a>&#160;</td>
          <td class="paramname"><em>rid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Insert a new entry using the pair &lt;value,rid&gt;. Start from root to recursively find out the leaf to insert the entry in. The insertion may cause splitting of leaf node. This splitting will require addition of new leaf page number entry into the parent non-leaf, which may in-turn get split. This may continue all the way upto the root causing the root to get split. If root gets split, metapage needs to be changed accordingly. Make sure to unpin pages as soon as you can. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td>Key to insert, pointer to integer/double/char string </td></tr>
    <tr><td class="paramname">rid</td><td>Record ID of a record whose entry is getting inserted into the index. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="btree_8cpp_source.html#l00133">133</a> of file <a class="el" href="btree_8cpp_source.html">btree.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// the initial level of the root</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordtype">int</span> rootLevel = 0;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// returnPageNo is 0 if no split occurred</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> returnPageNo =0;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="keywordtype">void</span> *middleKey = <span class="keyword">new</span> int;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="comment">// recursively insert the key to each node</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  returnPageNo = insert(key, rid, middleKey, rootPageNum);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// if the root need to split, create new root</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (returnPageNo != 0) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// once root split,increment the root level</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    rootLevel++;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    Page *newRootPage;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> newRootPageNo;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// allocate a new page for root</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    bufMgr -&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#ab9ae3b12aac55b119b5763e3de2a4d2b">allocPage</a>(file, newRootPageNo, newRootPage);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// create a new root node</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    NonLeafNodeInt *newRoot = (NonLeafNodeInt *)newRootPage;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// push up the middle key from the child</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    newRoot-&gt;keyArray[0] = *((<span class="keywordtype">int</span>*) middleKey);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// the first pageNo is the old root page number</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    newRoot-&gt;pageNoArray[0] = rootPageNum;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// the second pageNo is the pageNo of the new sibling node of old root</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    newRoot-&gt;pageNoArray[1] = returnPageNo;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    newRoot-&gt;numKeys = 1;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    newRoot-&gt;level = rootLevel;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// update the meta data information</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    Page *metaPage;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    rootPageNum = newRootPageNo;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">readPage</a>(file, headerPageNum, metaPage);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    IndexMetaInfo * metaNode = (IndexMetaInfo* ) metaPage;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    metaNode-&gt;rootPageNo = newRootPageNo;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// unPin the pages</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    bufMgr -&gt; unPinPage (file, headerPageNum, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    bufMgr -&gt; unPinPage (file, newRootPageNo, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_a9f853f0f1d4628e7e14374d0c7c6a4f3"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">badgerdb::BufMgr::readPage</a></div><div class="ttdeci">void readPage(File *file, const PageId PageNo, Page *&amp;page)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00120">buffer.cpp:120</a></div></div>
<div class="ttc" id="namespacebadgerdb_html_a1f49e404293bf4240756b89b53b1587a"><div class="ttname"><a href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">badgerdb::PageId</a></div><div class="ttdeci">std::uint32_t PageId</div><div class="ttdoc">Identifier for a page in a file. </div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00015">types.h:15</a></div></div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_ab9ae3b12aac55b119b5763e3de2a4d2b"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#ab9ae3b12aac55b119b5763e3de2a4d2b">badgerdb::BufMgr::allocPage</a></div><div class="ttdeci">void allocPage(File *file, PageId &amp;PageNo, Page *&amp;page)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00213">buffer.cpp:213</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0834ba4655cac7af31ce1b8f2f18f0e1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void badgerdb::BTreeIndex::scanNext </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structbadgerdb_1_1_record_id.html">RecordId</a> &amp;&#160;</td>
          <td class="paramname"><em>outRid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Fetch the record id of the next index entry that matches the scan. Return the next record from current page being scanned. If current page has been scanned to its entirety, move on to the right sibling of current page, if any exists, to start scanning that page. Make sure to unpin any pages that are no longer required. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">outRid</td><td><a class="el" href="structbadgerdb_1_1_record_id.html" title="Identifier for a record in a page. ">RecordId</a> of next record found that satisfies the scan criteria returned in this </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="classbadgerdb_1_1_scan_not_initialized_exception.html" title="An exception that is thrown when a file operation is requested for a filename that doesn&#39;t exist...">ScanNotInitializedException</a></td><td>If no scan has been initialized. </td></tr>
    <tr><td class="paramname"><a class="el" href="classbadgerdb_1_1_index_scan_completed_exception.html" title="An exception that is thrown when a file operation is requested for a filename that doesn&#39;t exist...">IndexScanCompletedException</a></td><td>If no more records, satisfying the scan criteria, are left to be scanned. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="btree_8cpp_source.html#l00550">550</a> of file <a class="el" href="btree_8cpp_source.html">btree.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;{</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="comment">// If no scan has been initialized throws ScanNotInitializedException</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordflow">if</span>(!scanExecuting){</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">throw</span> ScanNotInitializedException();</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">// cast into leaf node</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  LeafNodeInt *currLeafNode = (LeafNodeInt *) currentPageData;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">// if the next entry in the range</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="keywordflow">if</span>(nextEntry &lt; (currLeafNode-&gt;numKeys)-1){</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">if</span>( highOp == LT &amp;&amp; currLeafNode-&gt;keyArray[nextEntry] &lt; highValInt) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      outRid = currLeafNode-&gt;ridArray[nextEntry];</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( highOp == LTE &amp;&amp; currLeafNode-&gt;keyArray[nextEntry] &lt;= highValInt) {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      outRid = currLeafNode-&gt;ridArray[nextEntry];</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">// If no more records, satisfying the scan criteria, are left to be scanned.</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="keywordflow">throw</span> IndexScanCompletedException();</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    nextEntry ++;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="comment">//  If current page has been scanned to its entirety, move on to the right sibling of current page</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    nextEntry = 0;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">// move to right sibling of the current page</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <a class="code" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> nextPageNo = currLeafNode-&gt;rightSibPageNo;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="comment">// unPin any pages that are no longer required</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">unPinPage</a>(file, currentPageNum,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="comment">// read the next page</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    currentPageNum = nextPageNo;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">if</span>(currentPageNum == 0){</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">throw</span> IndexScanCompletedException();</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">readPage</a>(file, currentPageNum, currentPageData);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;}</div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_a9f853f0f1d4628e7e14374d0c7c6a4f3"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">badgerdb::BufMgr::readPage</a></div><div class="ttdeci">void readPage(File *file, const PageId PageNo, Page *&amp;page)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00120">buffer.cpp:120</a></div></div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_aa9bdf04c8543f59744db22efa9420c89"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">badgerdb::BufMgr::unPinPage</a></div><div class="ttdeci">void unPinPage(File *file, const PageId PageNo, const bool dirty)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00154">buffer.cpp:154</a></div></div>
<div class="ttc" id="namespacebadgerdb_html_a1f49e404293bf4240756b89b53b1587a"><div class="ttname"><a href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">badgerdb::PageId</a></div><div class="ttdeci">std::uint32_t PageId</div><div class="ttdoc">Identifier for a page in a file. </div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00015">types.h:15</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa0426d99197f0ad5b2054df595243437"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void badgerdb::BTreeIndex::startScan </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>lowVal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacebadgerdb.html#aad50f9c7a9ef0cbcfe0b025a7aa5cb28">Operator</a>&#160;</td>
          <td class="paramname"><em>lowOp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>highVal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacebadgerdb.html#aad50f9c7a9ef0cbcfe0b025a7aa5cb28">Operator</a>&#160;</td>
          <td class="paramname"><em>highOp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Begin a filtered scan of the index. For instance, if the method is called using ("a",GT,"d",LTE) then we should seek all entries with a value greater than "a" and less than or equal to "d". If another scan is already executing, that needs to be ended here. Set up all the variables for scan. Start from root to find out the leaf page that contains the first RecordID that satisfies the scan parameters. Keep that page pinned in the buffer pool. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lowVal</td><td>Low value of range, pointer to integer / double / char string </td></tr>
    <tr><td class="paramname">lowOp</td><td>Low operator (GT/GTE) </td></tr>
    <tr><td class="paramname">highVal</td><td>High value of range, pointer to integer / double / char string </td></tr>
    <tr><td class="paramname">highOp</td><td>High operator (LT/LTE) </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname"><a class="el" href="classbadgerdb_1_1_bad_opcodes_exception.html" title="An exception that is thrown when some unexpected error occurs in the hash table. ">BadOpcodesException</a></td><td>If lowOp and highOp do not contain one of their their expected values </td></tr>
    <tr><td class="paramname"><a class="el" href="classbadgerdb_1_1_bad_scanrange_exception.html" title="An exception that is thrown when some unexpected error occurs in the hash table. ">BadScanrangeException</a></td><td>If lowVal &gt; highval </td></tr>
    <tr><td class="paramname"><a class="el" href="classbadgerdb_1_1_no_such_key_found_exception.html" title="An exception that is thrown when a file operation is requested for a filename that doesn&#39;t exist...">NoSuchKeyFoundException</a></td><td>If there is no key in the B+ tree that satisfies the scan criteria. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="btree_8cpp_source.html#l00456">456</a> of file <a class="el" href="btree_8cpp_source.html">btree.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;{</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">// set a flag to determine whether the first RecordID has been found or not</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordtype">bool</span> isFound = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="comment">// if low operator does not support GT and GTE or high operator does not support LT and LTE</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">// throw BadOpcodesException</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keywordflow">if</span> ((lowOpParm !=GT &amp;&amp; lowOpParm !=GTE) || (highOpParm != LT &amp;&amp; highOpParm != LTE)) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    scanExecuting = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">throw</span> BadOpcodesException();</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="comment">// If another scan is already executing, that needs to be ended here.</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordflow">if</span> (scanExecuting) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="classbadgerdb_1_1_b_tree_index.html#a78093b184e3ed6faf6edd8e90010583b">endScan</a>();</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  lowValInt = *(<span class="keywordtype">int</span> *)lowValParm;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  highValInt = *(<span class="keywordtype">int</span> *)highValParm;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="comment">// if lowValue &gt; highValue, throw BadScanrangeException</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">if</span>(lowValInt &gt; highValInt){</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    scanExecuting = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">throw</span> BadScanrangeException();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">// Set up all the variables for scan.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  scanExecuting = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  lowOp = lowOpParm;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  highOp = highOpParm;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  currentPageNum = rootPageNum;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">// Start from root to find out the leaf page that contains the first RecordID</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">while</span>(!isFound){</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">// read the current page</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">readPage</a>(file, currentPageNum, currentPageData);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    NonLeafNodeInt *nonLeafNode = (NonLeafNodeInt *) currentPageData;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">// if the current node is Leaf node</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">if</span>(nonLeafNode-&gt;level == 0){</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      LeafNodeInt *leafNode = (LeafNodeInt *) currentPageData;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; leafNode-&gt;numKeys; i++){</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span>(lowOpParm == GTE &amp;&amp; leafNode-&gt;keyArray[i] &gt;= lowValInt) {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;          nextEntry = i;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;          isFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(lowOpParm == GT &amp;&amp; leafNode-&gt;keyArray[i] &gt; lowValInt){</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;          nextEntry = i;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;          isFound = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="comment">// for non leaf node</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <a class="code" href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">PageId</a> previousPageNum = currentPageNum;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="comment">//  if low value &lt; the first</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="keywordflow">if</span>(lowValInt &lt; nonLeafNode-&gt;keyArray[0]) {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        currentPageNum = nonLeafNode-&gt;pageNoArray[0];</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="comment">// else if the low value &gt; the last</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(lowValInt &gt; nonLeafNode-&gt;keyArray[nonLeafNode-&gt;numKeys-1] ){</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        currentPageNum = nonLeafNode-&gt;pageNoArray[nonLeafNode-&gt;numKeys];</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="comment">// in between</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nonLeafNode-&gt;numKeys; i++){</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;          <span class="keywordflow">if</span> (lowValInt &gt;= nonLeafNode-&gt;keyArray[i] &amp;&amp; lowValInt &lt;= nonLeafNode-&gt;keyArray[i+1]) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            currentPageNum = nonLeafNode-&gt;pageNoArray[i+1];</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;          }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      bufMgr-&gt;<a class="code" href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">unPinPage</a>(file, previousPageNum,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_a9f853f0f1d4628e7e14374d0c7c6a4f3"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#a9f853f0f1d4628e7e14374d0c7c6a4f3">badgerdb::BufMgr::readPage</a></div><div class="ttdeci">void readPage(File *file, const PageId PageNo, Page *&amp;page)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00120">buffer.cpp:120</a></div></div>
<div class="ttc" id="classbadgerdb_1_1_buf_mgr_html_aa9bdf04c8543f59744db22efa9420c89"><div class="ttname"><a href="classbadgerdb_1_1_buf_mgr.html#aa9bdf04c8543f59744db22efa9420c89">badgerdb::BufMgr::unPinPage</a></div><div class="ttdeci">void unPinPage(File *file, const PageId PageNo, const bool dirty)</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8cpp_source.html#l00154">buffer.cpp:154</a></div></div>
<div class="ttc" id="namespacebadgerdb_html_a1f49e404293bf4240756b89b53b1587a"><div class="ttname"><a href="namespacebadgerdb.html#a1f49e404293bf4240756b89b53b1587a">badgerdb::PageId</a></div><div class="ttdeci">std::uint32_t PageId</div><div class="ttdoc">Identifier for a page in a file. </div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00015">types.h:15</a></div></div>
<div class="ttc" id="classbadgerdb_1_1_b_tree_index_html_a78093b184e3ed6faf6edd8e90010583b"><div class="ttname"><a href="classbadgerdb_1_1_b_tree_index.html#a78093b184e3ed6faf6edd8e90010583b">badgerdb::BTreeIndex::endScan</a></div><div class="ttdeci">const void endScan()</div><div class="ttdef"><b>Definition:</b> <a href="btree_8cpp_source.html#l00599">btree.cpp:599</a></div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/afs/cs.wisc.edu/u/m/i/miao/private/cs564/P4/Btree/src/<a class="el" href="btree_8h_source.html">btree.h</a></li>
<li>/afs/cs.wisc.edu/u/m/i/miao/private/cs564/P4/Btree/src/<a class="el" href="btree_8cpp_source.html">btree.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Dec 6 2016 22:11:46 for BadgerDB by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
